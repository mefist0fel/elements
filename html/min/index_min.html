<html>
	<head>
		<title>Elements prot</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:#ffffff;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="tutorial"></canvas>
	</body>
	<script type="text/javascript">function c(b,a){return[b[0]+a[0],b[1]+a[1],b[2]+a[2]]}function g(b,a){return[b[0]-a[0],b[1]-a[1],b[2]-a[2]]}function k(b,a){return Math.sqrt((b[0]-a[0])*(b[0]-a[0])+(b[1]-a[1])*(b[1]-a[1]))}function p(b){var a=1/k(b,[0,0,0]);0>=a&&(a=1E-10);Infinity==a&&(a=1E13);-Infinity==a&&(a=-1E13);return q(b,a)}function q(b,a){return[b[0]*a,b[1]*a,b[2]*a]}function r(b){var a=newCoord;return a[0]>=b[0]&&a[0]<=b[2]&&a[1]>=b[1]&&a[1]<=b[3]}
var s=[1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,2,1,0,0,1,0,0,0,1,1,0,0,1,0,0,1,3,2,1,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,2,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,1,1,0,0,1,0,0,0,1,1,0,0,1,0,0,3,3,2,0,1,0,0,0,1,1,1,0,1,0,0,0,4,3,2,1,1,1,0,0,0,0,0,1,1,1,0,0,4,3,2,0,0,0,0,0,0,1,0,0,0,0,0,0,6,3,3,1,0,0,0,0,0,0,0,1,0,0,0,0,5,3,3,2,1,1,0,0,0,0,1,1,1,0,0,0,4,3,3,2,0,1,0,
0,0,0,0,1,0,0,0,0],t,u=0,w=v(),x=1/30,y=[8,8,0];function z(){return{c:!1,position:[0,0,0],b:[0,0,0],d:100,a:.2}}var A=document.getElementById("tutorial"),B=A.getContext("2d");A.width=1024;A.height=768;rect=A.getBoundingClientRect();
var C=function(b){for(var a={key:[200],e:!1,f:[0,0]},d=0;200>d;d++)a.key[d]=!1;document.addEventListener("keydown",function(b){a.key[b.keyCode]=!0},!1);document.addEventListener("keyup",function(b){a.key[b.keyCode]=!1},!1);document.addEventListener("click",function(){},!1);document.addEventListener("mousedown",function(){a.e=!0},!1);document.addEventListener("mouseup",function(){a.e=!1},!1);document.addEventListener("mousemove",function(d){a.f[0]=d.clientX-b.left;a.f[1]=d.clientY-b.top},!1);document.addEventListener("touchstart",
function(){},!1);document.addEventListener("touchmove",function(){},!1);return a}(rect,A),D=z(),E=!1;D.position=[3.5,3.5,2];var F=.3,G=0,H=[];function I(b){return[1.8*Math.sin(b/180*3.14),1.8*Math.cos(b/180*3.14),0]}for(var J=[200],K=0;200>K;K++)J[K]=z();function v(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}var L=[70,40],M=[40,-70],N=42,O=1.6/3,P=50;
function Q(b){var a=O,d=Math.sin(b/180*3.14);b=Math.cos(b/180*3.14);0>N&&(N+=360);360<=N&&(N-=360);var m=N;H=[I(m+180),I(m+0),I(m+90),I(m+270)];return[70*d,70*b*a]}L=Q(N-90);M=Q(N);function R(b){b=g(b,y);return[b[0]*L[0]+b[1]*M[0]+512,b[0]*L[1]+b[1]*M[1]+384-b[2]*P]}function S(b){B.beginPath();var a=R(b[0]);B.moveTo(a[0],a[1]);for(var d=1;d<b.length;d++)a=R(b[d]),B.lineTo(a[0],a[1]);B.closePath();B.fill();B.stroke()}function T(b){return"rgba("+b+","+b+","+b+",1)"}
function U(b,a){coordA=R(b);coordB=R(a);return coordA[0]<coordB[0]}for(var V=[16],K=0;16>K;K++)V[K]=[Math.cos(22*K/180*3.14),Math.sin(22*K/180*3.14)];
function W(){t=v();u+=Math.min(1,(t-w)/1E3);u>x&&(u=x);G+=x;1.8<G&&(G=0);F=.06*Math.sin(G/1.8*6.28)+.4;D.b=[0,0,D.b[2]];if(C.key[38]||C.key[87])D.b=c(D.b,H[0]);if(C.key[40]||C.key[83])D.b=c(D.b,H[1]);if(C.key[37]||C.key[65])D.b=c(D.b,H[2]);if(C.key[39]||C.key[68])D.b=c(D.b,H[3]);C.key[32]&&E&&(D.b=c(D.b,[0,0,3]),E=!1);C.key[69]&&(N+=1,L=Q(N-90),M=Q(N));C.key[81]&&(N-=1,L=Q(N-90),M=Q(N));C.key[67]&&(O+=.01,1<=O&&(O=1),L=Q(N-90),M=Q(N));C.key[86]&&(O-=.01,-1>=O&&(O=-1),L=Q(N-90),M=Q(N));C.key[88]&&
(P+=.5,100<=P&&(P=100),L=Q(N-90),M=Q(N));C.key[90]&&(P-=.5,5>=P&&(P=5),L=Q(N-90),M=Q(N));if(C.e)for(var b=D.position,a=p(g(C.f,D.position)),d=0;200>d;d++)if(!J[d].c){J[d].c=!0;J[d].position=b;J[d].b=q(c(a,[.1*Math.random()-.05,.1*Math.random()-.05,0]),400);J[d].d=3;break}D.b[2]-=3*x;newCoord=c(D.position,q(D.b,x));b=[Math.floor(D.position[0]),Math.floor(D.position[1])];for(a=Math.max(0,b[0]-1);a<=b[0]+1&&16>a;a++)for(d=Math.max(0,b[1]-1);d<=b[1]+1&&16>d;d++)if(0<s[16*a+d]){for(var m=.5*s[16*a+d],
l=[0,0,0],e=!1,h=[[a,d,0],[a+1,d,0],[a+1,d+1,0],[a,d+1,0]],f=0;4>f;f++){var n=k(newCoord,h[f]);n<=D.a&&(l=p(g(h[f],newCoord)),l[2]=0,l=q(l,n-D.a),e=!0)}r([a-D.a,d,a+1+D.a,d+1])&&(l[1]=0,e=!0,l[0]=newCoord[0]<a+.5?a-D.a-newCoord[0]:a+1+D.a-newCoord[0]);r([a,d-D.a,a+1,d+1+D.a])&&(l[0]=0,e=!0,l[1]=newCoord[1]<d+.5?d-D.a-newCoord[1]:d+1+D.a-newCoord[1]);e&&m>=newCoord[2]&&m<=D.position[2]&&(D.b[2]=0,E=!0,newCoord[2]=m)}for(a=Math.max(0,b[0]-1);a<=b[0]+1&&16>a;a++)for(d=Math.max(0,b[1]-1);d<=b[1]+1&&16>
d;d++)if(0<s[16*a+d]){m=.5*s[16*a+d];l=[0,0,0];e=!1;h=[[a,d,0],[a+1,d,0],[a+1,d+1,0],[a,d+1,0]];for(f=0;4>f;f++)n=k(newCoord,h[f]),n<=D.a&&(l=p(g(h[f],newCoord)),l[2]=0,l=q(l,n-D.a),e=!0);r([a-D.a,d,a+1+D.a,d+1])&&(l[1]=0,e=!0,collideH=m,l[0]=newCoord[0]<a+.5?a-D.a-newCoord[0]:a+1+D.a-newCoord[0]);r([a,d-D.a,a+1,d+1+D.a])&&(l[0]=0,e=!0,l[1]=newCoord[1]<d+.5?d-D.a-newCoord[1]:d+1+D.a-newCoord[1]);e&&m>newCoord[2]&&(newCoord=c(newCoord,l))}-5>newCoord[2]&&(D.b[2]=0,newCoord=[3.5,3.5,2],E=!0);D.position=
newCoord;for(a=0;200>a;a++)J[a].c&&(J[a].position=c(J[a].position,q(J[a].b,x)),J[a].d-=x,0>J[a].d&&(J[a].c=!1));y=c(q(y,.9),q(c(D.position,[0,0,-.4]),.1));B.fillStyle="#000000";B.fillRect(0,0,1024,768);b=[Math.floor(D.position[0]),Math.floor(D.position[1])];180<N?.5*s[16*Math.floor(D.position[0]-D.a)+Math.floor(D.position[1])]<=D.position[2]&&(b[0]-=1):.5*s[16*Math.floor(D.position[0]+D.a)+Math.floor(D.position[1])]<=D.position[2]&&(b[0]+=1);90<N&&270>N?.5*s[16*Math.floor(D.position[0])+Math.floor(D.position[1]-
D.a)]<=D.position[2]&&(b[1]-=1):.5*s[16*Math.floor(D.position[0])+Math.floor(D.position[1]+D.a)]<=D.position[2]&&(b[1]+=1);for(a=0;16>a;a++)for(d=0;16>d;d++){m=a;l=d;180<N&&(m=15-a);90<N&&270>N&&(l=15-d);if(0<s[16*m+l]&&(e=m,f=l,h=.5*s[16*m+l],n=-.34*((m%3+l%5)%7+1),U([e+1,f,h],[e+1,f+1,h])&&(B.fillStyle=T(180+(e+f)%2*20-(e+f)%3*8),B.strokeStyle=B.fillStyle,S([[e+1,f,h],[e+1,f+1,h],[e+1,f+1,n],[e+1,f,n]])),U([e+1,f+1,h],[e,f+1,h])&&(B.fillStyle=T(160+(e+f)%2*20-(e+f)%3*8),B.strokeStyle=B.fillStyle,
S([[e+1,f+1,h],[e,f+1,h],[e,f+1,n],[e+1,f+1,n]])),U([e,f+1,h],[e,f,h])&&(B.fillStyle=T(180+(e+f)%2*20-(e+f)%3*8),B.strokeStyle=B.fillStyle,S([[e,f+1,h],[e,f,h],[e,f,n],[e,f+1,n]])),U([e,f,h],[e+1,f,h])&&(B.fillStyle=T(160+(e+f)%2*20-(e+f)%3*8),B.strokeStyle=B.fillStyle,S([[e,f,h],[e+1,f,h],[e+1,f,n],[e,f,n]])),B.fillStyle=.5<(e+f)%2?T(240+10*h):T(230+10*h),B.strokeStyle=B.fillStyle,S([[e,f,h],[e+1,f,h],[e+1,f+1,h],[e,f+1,h]]),!(0>h)&&(h=Math.floor(D.position[0]-.5),n=Math.floor(D.position[1]-.5),
!(e!=h&&e!=h+1||f!=n&&f!=n+1)&&(B.fillStyle="rgba(0,0,0,0.2)",B.strokeStyle="rgba(0,0,0,0.0)",e=[e,f],0<s[16*e[0]+e[1]])))){for(var f=.5*s[16*e[0]+e[1]],n=D.a*(1-.14*Math.max(0,D.position[2]-f)),X=[8],h=0;h<V.length;h++)X[h]=[Math.max(e[0],Math.min(e[0]+1,D.position[0]+V[h][0]*n)),Math.max(e[1],Math.min(e[1]+1,D.position[1]+V[h][1]*n)),f];S(X);B.fill()}b[0]==m&&b[1]==l&&(B.fillStyle="#FF0000",B.beginPath(),m=R(c(D.position,[0,0,F])),B.arc(m[0],m[1],72*D.a,0,2*Math.PI),B.closePath(),B.fill(),B.fillStyle=
"#FFFFFF",B.beginPath(),B.arc(m[0]+1.2*D.a*18,m[1]-1.2*D.a*18,14.4*D.a,0,2*Math.PI),B.closePath(),B.fill())}for(a=0;200>a;a++)J[a].c&&B.fillRect(J[a].position[0]-1,J[a].position[1]-1,2,2);B.font="14pt Arial";B.fillText("Q / E - Rotate level",10,30);B.fillText("Z / X - change height constant",10,50);B.fillText("C / V - change tile aspect",10,70);B.fillText("Camera angle "+N,10,90);w=t;requestAnimationFrame(W)}requestAnimationFrame(W);

	</script>
</html>